parameters:
  language: ''
  repo: ''
  branch: ''
  commit: ''
  forced_image: ''

steps:

- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'
    architecture: 'x64'
  condition: and(succeeded(),eq(variables['forced_image'], ''))

- script: |
    python3 -m pip install -r $(Horton.FrameworkRoot)/pyscripts/requirements.txt
    python3 $(Horton.FrameworkRoot)/pyscripts/build_docker_image.py --language ${{ parameters.language }}  --repo ${{ parameters.repo }} --branch ${{ parameters.branch }} --commit ${{ parameters.commit }}
  displayName: "build docker image ${{ parameters.language }}" 
  condition: and(succeeded(),eq(variables['forced_image'], ''))
  env: 
    IOTHUB_E2E_REPO_ADDRESS: $(IOTHUB-E2E-REPO-ADDRESS)
    IOTHUB_E2E_REPO_USER: $(IOTHUB-E2E-REPO-USER)
    IOTHUB_E2E_REPO_PASSWORD: $(IOTHUB-E2E-REPO-PASSWORD)
    Build.BuildId: $(Build.BuildId)

